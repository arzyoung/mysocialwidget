<script>
    // Fetch posts from the backend when the page loads
    fetch('https://mysocialwidget.onrender.com/api/posts')
      .then(response => response.json())
      .then(data => {
        const postsDiv = document.getElementById('posts');
        data.reverse().forEach(post => {
          const postElement = document.createElement('div');
          postElement.innerHTML = `
            <h2>${post.title}</h2>
            <p>${post.content}</p>
            <button class="like-button">üëç Like (${post.likes})</button>
            <button class="reply-button">üí¨ Reply</button>
            <div class="comments">
              ${post.comments.map(comment => `<p>${comment}</p>`).join('')}
            </div>
            <div class="reply-form" style="display: none;">
              <input type="text" class="comment-input" placeholder="Write a comment...">
              <button class="submit-comment">Post Comment</button>
            </div>
          `;
          postsDiv.appendChild(postElement);
  
          // Handle Like button click
          const likeButton = postElement.querySelector('.like-button');
          likeButton.addEventListener('click', () => {
            fetch('https://mysocialwidget.onrender.com/api/posts/like', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ title: post.title })
            })
            .then(response => response.json())
            .then(updatedPost => {
              likeButton.innerText = `üëç Like (${updatedPost.likes})`;
            });
          });
  
          // Handle Reply button click
          const replyButton = postElement.querySelector('.reply-button');
          const replyForm = postElement.querySelector('.reply-form');
          replyButton.addEventListener('click', () => {
            replyForm.style.display = replyForm.style.display === 'none' ? 'block' : 'none';
          });
  
          // Handle Submit Comment button click
          const submitCommentButton = postElement.querySelector('.submit-comment');
          submitCommentButton.addEventListener('click', () => {
            const commentInput = postElement.querySelector('.comment-input');
            const comment = commentInput.value;
            if (comment) {
              fetch('https://mysocialwidget.onrender.com/api/posts/comment', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: post.title, comment: comment })
              })
              .then(response => response.json())
              .then(updatedPost => {
                const commentsDiv = postElement.querySelector('.comments');
                commentsDiv.innerHTML = updatedPost.comments.map(comment => `<p>${comment}</p>`).join('');
                commentInput.value = '';
              });
            }
          });
        });
      });
  
    // Handle form submission to add a new post
    const form = document.getElementById('postForm');
    form.addEventListener('submit', function (event) {
      event.preventDefault();
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
  
      fetch('https://mysocialwidget.onrender.com/api/posts', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, content })
      })
        .then(response => response.json())
        .then(data => {
          const postsDiv = document.getElementById('posts');
          const postElement = document.createElement('div');
          postElement.innerHTML = `<h2>${data.title}</h2><p>${data.content}</p>`;
          postsDiv.prepend(postElement);
        });
    });
  </script>
  